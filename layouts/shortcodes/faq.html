{{/* layouts/shortcodes/faq.html */}}

<div class="custom-faq-card">
  <details class="faq-details">
    <summary class="faq-summary">
      <span class="faq-title">{{ .Get "title" }}</span>
      <span class="faq-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </span>
    </summary>
    <div class="faq-content">
      <div class="faq-body">
        {{ .Inner | markdownify }}
      </div>
    </div>
  </details>
</div>

<style>
  /* --- 1. КАРКАС --- */
  .custom-faq-card {
    background-color: transparent;
    border: 1px solid rgba(136, 136, 136, 0.2);
    border-radius: 0.75rem;
    margin-bottom: 1rem;
    position: relative;
    /* Важно для GPU ускорения */
    transform: translate3d(0,0,0);
    transition: background-color 0.2s, border-color 0.2s;
  }

  .custom-faq-card:hover {
    border-color: rgba(136, 136, 136, 0.4);
    background-color: rgba(136, 136, 136, 0.03);
    z-index: 5;
  }

  /* --- 2. ЗАГОЛОВОК --- */
  .faq-summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    cursor: pointer;
    list-style: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  .faq-summary::-webkit-details-marker { display: none; }

  .faq-title {
    font-weight: 600;
    font-size: 1.05rem;
    color: inherit;
  }

  /* --- 3. ИКОНКА --- */
  .faq-icon {
    display: flex;
    align-items: center;
    color: #888;
    transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
  }
  
  /* Поворот иконки при наличии класса .is-expanded */
  details.is-expanded .faq-icon {
    transform: rotate(180deg);
  }

  /* --- 4. АНИМАЦИЯ КОНТЕНТА (GRID TRICK) --- */
  .faq-content {
    display: grid;
    /* По умолчанию закрыто */
    grid-template-rows: 0fr;
    /* Очень плавная кривая Безье */
    transition: grid-template-rows 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    overflow: hidden; /* Обязательно скрываем вылезающее во время анимации */
  }

  /* Состояние "Раскрыто" */
  details.is-expanded .faq-content {
    grid-template-rows: 1fr;
  }

  /* Когда анимация закончилась и класс overflow-visible добавлен скриптом */
  details.is-expanded.overflow-visible .faq-content {
    overflow: visible;
  }
  
  details.is-expanded.overflow-visible .faq-body {
    overflow: visible;
  }

  /* --- 5. АНИМАЦИЯ ТЕКСТА (OPACITY) --- */
  .faq-body {
    min-height: 0;
    padding: 0 1.25rem;
    /* Скрываем отступы в закрытом состоянии, чтобы не было рывка */
    padding-bottom: 0;
    opacity: 0;
    transition: opacity 0.3s ease, padding 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    box-sizing: border-box;
    overflow: hidden;
  }

  details.is-expanded .faq-body {
    opacity: 1;
    padding-bottom: 1.25rem;
    /* Небольшая задержка появления текста, чтобы рамка успела поехать */
    transition-delay: 0.1s; 
  }

  /* Линия разделитель */
  .faq-body::before {
    content: "";
    display: block;
    width: 100%;
    height: 1px;
    background: rgba(136, 136, 136, 0.1);
    margin-bottom: 1rem;
    opacity: 0;
    transition: opacity 0.3s;
  }
  details.is-expanded .faq-body::before {
    opacity: 1;
  }

  /* --- DARK MODE --- */
  :is(html.dark, body.dark) .custom-faq-card {
    border-color: rgba(255, 255, 255, 0.1);
    background-color: rgba(255, 255, 255, 0.02);
  }
  :is(html.dark, body.dark) .custom-faq-card:hover {
    border-color: rgba(255, 255, 255, 0.2);
    background-color: rgba(255, 255, 255, 0.05);
  }
  :is(html.dark, body.dark) .faq-body { color: #a3a3a3; }
  :is(html.dark, body.dark) .faq-title { color: #f5f5f5; }
</style>

<script>
  if (typeof window.faqLogicInitialized === 'undefined') {
    window.faqLogicInitialized = true;

    document.addEventListener("DOMContentLoaded", () => {
      const container = document.body;

      container.addEventListener('click', (e) => {
        const summary = e.target.closest('.faq-summary');
        if (!summary) return;

        const details = summary.parentElement;
        if (!details.classList.contains('faq-details')) return;

        // 1. Останавливаем стандартное поведение браузера (рывок)
        e.preventDefault();

        // Если уже идет анимация, игнорируем клики (защита от дёрганья)
        if (details.dataset.isAnimating === 'true') return;
        
        details.dataset.isAnimating = 'true';
        const content = details.querySelector('.faq-content');

        // --- ЛОГИКА ЗАКРЫТИЯ ---
        if (details.classList.contains('is-expanded')) {
          // Сначала убираем overflow visible, чтобы обрезать контент при сворачивании
          details.classList.remove('overflow-visible');
          
          // Даем браузеру кадр на применение overflow: hidden
          requestAnimationFrame(() => {
            // Запускаем анимацию сворачивания
            details.classList.remove('is-expanded');
            
            // Ждем конца CSS перехода
            content.addEventListener('transitionend', () => {
              details.removeAttribute('open'); // Убираем атрибут open из DOM
              details.dataset.isAnimating = 'false';
            }, { once: true });
          });
        } 
        
        // --- ЛОГИКА ОТКРЫТИЯ ---
        else {
          // 1. Добавляем open в DOM (высота всё еще 0fr из-за CSS)
          details.setAttribute('open', 'true');
          
          // 2. Двойной RAF (RequestAnimationFrame) гарантирует, что браузер отрисовал начальное состояние (0fr)
          // перед тем как мы добавим класс для расширения (1fr). Это и есть секрет плавности.
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              details.classList.add('is-expanded');
              
              // Ждем конца анимации
              content.addEventListener('transitionend', () => {
                // Разрешаем подсказкам вылезать (overflow: visible)
                details.classList.add('overflow-visible');
                details.dataset.isAnimating = 'false';
              }, { once: true });
            });
          });
        }
      });
    });
  }
</script>